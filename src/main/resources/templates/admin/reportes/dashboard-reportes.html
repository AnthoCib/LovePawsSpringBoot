<!DOCTYPE html>
<html lang="es"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Reportes | Admin</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link th:href="@{/css/admin.css}" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="admin-dark">

<div class="d-flex">

    <!-- SIDEBAR -->
    <div th:replace="fragments/admin-sidebar :: adminSidebar"></div>

    <!-- CONTENIDO -->
    <main class="admin-content w-100 p-4">

        <!-- HEADER -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="fw-bold">üìä Reportes del sistema</h2>

            <a th:href="@{/admin/reportes/pdf}" class="btn btn-danger">
                <i class="bi bi-file-earmark-pdf"></i> Exportar PDF
            </a>
        </div>

        <!-- M√âTRICAS -->
        <div class="row g-4 mb-5 text-center">

            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="bi bi-people fs-3"></i>
                    </div>
                    <h6>Usuarios</h6>
                    <h2 th:text="${totalUsuarios}">0</h2>
                </div>
            </div>

            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fa-solid fa-paw fs-3"></i>
                    </div>
                    <h6>Mascotas</h6>
                    <h2 th:text="${totalMascotas}">0</h2>
                </div>
            </div>

        </div>

        <!-- FILTROS -->
        <div class="card section-card mb-4 p-4">
            <h6 class="fw-bold mb-3">
                <i class="bi bi-funnel-fill text-primary"></i> Filtros de reporte
            </h6>

            <form method="get" class="row g-3 align-items-end">
                <div class="col-md-4">
                    <label class="form-label fw-semibold">Desde</label>
                    <input type="date" name="desde" class="form-control">
                </div>

                <div class="col-md-4">
                    <label class="form-label fw-semibold">Hasta</label>
                    <input type="date" name="hasta" class="form-control">
                </div>

                <div class="col-md-4">
                    <button class="btn btn-primary w-100">
                        <i class="bi bi-search"></i> Aplicar filtros
                    </button>
                </div>
            </form>
        </div>

        <!-- GR√ÅFICOS -->
        <div class="row g-4">

            <div class="col-md-6">
                <div class="card section-card p-4 h-100">
                    <h5 class="fw-bold mb-3">üêæ Mascotas por estado</h5>
                    <canvas id="mascotasChart"></canvas>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card section-card p-4 h-100">
                    <h5 class="fw-bold mb-3">üë• Usuarios por rol</h5>
                    <canvas id="usuariosChart"></canvas>
                </div>
            </div>

        </div>

    </main>
</div>

<!-- DATOS -->
<script th:inline="javascript">
    const mascotasLabels = [];
    const mascotasData = [];
    /*[# th:each="item : ${mascotasPorEstado}"]*/
    mascotasLabels.push('[[${item.estado}]]');
    mascotasData.push([[${item.total}]]);
    /*[/]*/

    const usuariosLabels = [];
    const usuariosData = [];
    /*[# th:each="item : ${usuariosPorRol}"]*/
    usuariosLabels.push('[[${item.rol}]]');
    usuariosData.push([[${item.total}]]);
    /*[/]*/
</script>

<!-- CHARTS -->
<script>
    new Chart(document.getElementById('mascotasChart'), {
        type: 'doughnut',
        data: {
            labels: mascotasLabels,
            datasets: [{
                data: mascotasData,
                backgroundColor: ['#198754', '#ffc107', '#6c757d']
            }]
        }
    });

    new Chart(document.getElementById('usuariosChart'), {
        type: 'bar',
        data: {
            labels: usuariosLabels,
            datasets: [{
                label: 'Usuarios',
                data: usuariosData,
                backgroundColor: '#0d6efd'
            }]
        },
        options: {
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
</script>

</body>
</html>
