<!DOCTYPE html>
<html lang="es"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Catálogos | Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link th:href="@{/css/admin.css}" rel="stylesheet">
</head>
<body class="admin-dark">
<div class="d-flex">
    <div th:replace="fragments/admin-sidebar :: adminSidebar"></div>

    <main class="admin-content w-100 p-4">
        <h2 class="fw-bold mb-3"><i class="bi bi-journals me-2"></i>Gestión de Catálogos</h2>

        <div class="alert alert-success" th:if="${ok}" th:text="${ok}"></div>
        <div class="alert alert-danger" th:if="${error}" th:text="${error}"></div>

        <div class="card section-card shadow-sm mb-4">
            <div class="card-header bg-white fw-semibold"><i class="bi bi-git me-2"></i>Especies</div>
            <div class="card-body">
                <form th:action="@{/admin/catalogos/especies}" method="post" class="row g-2 mb-3">
                    <div class="col-md-8">
                        <input class="form-control" name="nombre" placeholder="Nueva especie" required>
                    </div>
                    <div class="col-md-2">
                        <select class="form-select" name="estado">
                            <option value="true">Activa</option>
                            <option value="false">Inactiva</option>
                        </select>
                    </div>
                    <div class="col-md-2 d-grid">
                        <button class="btn btn-primary"><i class="bi bi-plus-circle me-1"></i>Agregar</button>
                    </div>
                </form>

                <div class="table-responsive">
                    <table class="table table-sm align-middle">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Nombre</th>
                            <th>Estado</th>
                            <th class="text-end">Acciones</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="e : ${especies}">
                            <td th:text="${e.id}"></td>
                            <td>
                                <form th:action="@{/admin/catalogos/especies}" method="post" class="d-flex gap-2">
                                    <input type="hidden" name="id" th:value="${e.id}">
                                    <input class="form-control form-control-sm" name="nombre" th:value="${e.nombre}" required>
                                    <select class="form-select form-select-sm" name="estado">
                                        <option value="true" th:selected="${e.estado}">Activa</option>
                                        <option value="false" th:selected="${e.estado == null or !e.estado}">Inactiva</option>
                                    </select>
                                    <button class="btn btn-outline-primary btn-sm" title="Actualizar"><i class="bi bi-save"></i></button>
                                </form>
                            </td>
                            <td>
                                <span class="badge" th:classappend="${e.estado} ? 'bg-success' : 'bg-secondary'" th:text="${e.estado} ? 'Activa' : 'Inactiva'"></span>
                            </td>
                            <td class="text-end">
                                <form th:action="@{/admin/catalogos/especies/{id}/eliminar(id=${e.id})}" method="post" class="d-inline">
                                    <button class="btn btn-outline-danger btn-sm" title="Eliminar"><i class="bi bi-trash"></i></button>
                                </form>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="row g-4">
            <div class="col-lg-6">
                <div class="card section-card shadow-sm h-100">
                    <div class="card-header bg-white fw-semibold"><i class="bi bi-tags me-2"></i>Razas</div>
                    <div class="card-body">
                        <form method="get" th:action="@{/admin/catalogos}" class="row g-2 mb-3">
                            <div class="col-10">
                                <select class="form-select" name="especieId" onchange="this.form.submit()">
                                    <option th:each="e: ${especies}" th:value="${e.id}" th:selected="${especieSeleccionada == e.id}" th:text="${e.nombre}"></option>
                                </select>
                            </div>
                            <div class="col-2 d-grid">
                                <button class="btn btn-outline-secondary"><i class="bi bi-funnel"></i></button>
                            </div>
                        </form>

                        <form th:action="@{/admin/catalogos/razas}" method="post" class="row g-2 mb-3" th:if="${especieSeleccionada != null}">
                            <input type="hidden" name="especieId" th:value="${especieSeleccionada}">
                            <div class="col-md-8"><input class="form-control" name="nombre" placeholder="Nueva raza" required></div>
                            <div class="col-md-2">
                                <select class="form-select" name="estado">
                                    <option value="true">Activa</option>
                                    <option value="false">Inactiva</option>
                                </select>
                            </div>
                            <div class="col-md-2 d-grid">
                                <button class="btn btn-primary"><i class="bi bi-plus-circle"></i></button>
                            </div>
                        </form>

                        <div class="table-responsive">
                            <table class="table table-sm align-middle">
                                <thead>
                                <tr><th>#</th><th>Nombre</th><th>Estado</th><th></th></tr>
                                </thead>
                                <tbody>
                                <tr th:each="r : ${razas}">
                                    <td th:text="${r.id}"></td>
                                    <td>
                                        <form th:action="@{/admin/catalogos/razas}" method="post" class="d-flex gap-2">
                                            <input type="hidden" name="id" th:value="${r.id}">
                                            <input type="hidden" name="especieId" th:value="${r.especieId}">
                                            <input class="form-control form-control-sm" name="nombre" th:value="${r.nombre}" required>
                                            <select class="form-select form-select-sm" name="estado">
                                                <option value="true" th:selected="${r.estado}">Activa</option>
                                                <option value="false" th:selected="${r.estado == null or !r.estado}">Inactiva</option>
                                            </select>
                                            <button class="btn btn-outline-primary btn-sm"><i class="bi bi-save"></i></button>
                                        </form>
                                    </td>
                                    <td><span class="badge" th:classappend="${r.estado} ? 'bg-success' : 'bg-secondary'" th:text="${r.estado} ? 'Activa' : 'Inactiva'"></span></td>
                                    <td class="text-end">
                                        <form th:action="@{/admin/catalogos/razas/{id}/eliminar(id=${r.id})}" method="post" class="d-inline">
                                            <input type="hidden" name="especieId" th:value="${r.especieId}">
                                            <button class="btn btn-outline-danger btn-sm"><i class="bi bi-trash"></i></button>
                                        </form>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="card section-card shadow-sm h-100">
                    <div class="card-header bg-white fw-semibold"><i class="bi bi-bookmark-heart me-2"></i>Categorías</div>
                    <div class="card-body">
                        <form th:action="@{/admin/catalogos/categorias}" method="post" class="row g-2 mb-3">
                            <div class="col-md-5"><input class="form-control" name="nombre" placeholder="Nueva categoría" required></div>
                            <div class="col-md-5"><input class="form-control" name="descripcion" placeholder="Descripción"></div>
                            <div class="col-md-2 d-grid"><button class="btn btn-primary"><i class="bi bi-plus-circle"></i></button></div>
                        </form>

                        <div class="table-responsive">
                            <table class="table table-sm align-middle">
                                <thead><tr><th>#</th><th>Nombre</th><th>Descripción</th><th>Estado</th><th></th></tr></thead>
                                <tbody>
                                <tr th:each="c : ${categorias}">
                                    <td th:text="${c.id}"></td>
                                    <td colspan="2">
                                        <form th:action="@{/admin/catalogos/categorias}" method="post" class="row g-2">
                                            <input type="hidden" name="id" th:value="${c.id}">
                                            <div class="col-4"><input class="form-control form-control-sm" name="nombre" th:value="${c.nombre}" required></div>
                                            <div class="col-5"><input class="form-control form-control-sm" name="descripcion" th:value="${c.descripcion}"></div>
                                            <div class="col-2">
                                                <select class="form-select form-select-sm" name="estado">
                                                    <option value="true" th:selected="${c.estado}">Activa</option>
                                                    <option value="false" th:selected="${c.estado == null or !c.estado}">Inactiva</option>
                                                </select>
                                            </div>
                                            <div class="col-1 d-grid"><button class="btn btn-outline-primary btn-sm"><i class="bi bi-save"></i></button></div>
                                        </form>
                                    </td>
                                    <td><span class="badge" th:classappend="${c.estado} ? 'bg-success' : 'bg-secondary'" th:text="${c.estado} ? 'Activa' : 'Inactiva'"></span></td>
                                    <td class="text-end">
                                        <form th:action="@{/admin/catalogos/categorias/{id}/eliminar(id=${c.id})}" method="post" class="d-inline">
                                            <button class="btn btn-outline-danger btn-sm"><i class="bi bi-trash"></i></button>
                                        </form>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>
</body>
</html>
