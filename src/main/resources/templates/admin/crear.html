<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Registrar Usuario | Love Paws</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
<link href="/css/registroForm.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body class="py-5">

<div class="container">
	<div class="row justify-content-center">
		<div class="col-lg-7 col-md-9">
			<div class="card shadow-sm">
				<div class="card-body p-5">

					<h2 class="mb-4 text-center">Registrar Nuevo Usuario</h2>
					<p class="text-center text-muted mb-4">Crea tu cuenta para adoptar mascotas</p>

					<!-- Mensajes globales -->
					<div th:if="${errorCorreo}" class="alert alert-danger" th:text="${errorCorreo}"></div>
					<div th:if="${errorUsername}" class="alert alert-danger" th:text="${errorUsername}"></div>

					<form
						th:action="${isAdmin} ? @{/admin/usuarios/nuevo} : @{/registro}"
						th:object="${usuario}"
						method="post"
						novalidate>

						<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

						<div class="row g-3">

							<div class="col-md-6 position-relative">
								<i class="bi bi-person-circle form-icon"></i>
								<label class="form-label">Username <span>*</span></label>
								<input th:field="*{username}" class="form-control" required>
								<div class="text-danger small" th:errors="*{username}"></div>
							</div>

							<div class="col-md-6 position-relative">
								<i class="bi bi-person-fill form-icon"></i>
								<label class="form-label">Nombre <span>*</span></label>
								<input th:field="*{nombre}" class="form-control" required>
								<div class="text-danger small" th:errors="*{nombre}"></div>
							</div>

							<div class="col-md-6 position-relative">
								<i class="bi bi-envelope-fill form-icon"></i>
								<label class="form-label">Correo <span>*</span></label>
								<input th:field="*{correo}" type="email" class="form-control" required>
								<div class="text-danger small" th:errors="*{correo}"></div>
							</div>

							<div class="col-md-6 position-relative">
								<i class="bi bi-lock-fill form-icon"></i>
								<label class="form-label">Contraseña <span>*</span></label>
								<input th:field="*{passwordHash}" type="password" class="form-control" required>
								<div class="text-danger small" th:errors="*{passwordHash}"></div>
							</div>

							<div class="col-md-6 position-relative">
								<i class="bi bi-telephone-fill form-icon"></i>
								<label class="form-label">Teléfono <span>*</span></label>
								<input th:field="*{telefono}" class="form-control" required>
								<div class="text-danger small" th:errors="*{telefono}"></div>
							</div>

							<div class="col-12 position-relative">
								<i class="bi bi-geo-alt-fill form-icon"></i>
								<label class="form-label">Dirección <span>*</span></label>
								<input th:field="*{direccion}" class="form-control" required>
								<div class="text-danger small" th:errors="*{direccion}"></div>
							</div>

							<!-- ROL SOLO ADMIN -->
							<div class="col-md-6 position-relative" th:if="${isAdmin}">
								<i class="bi bi-people-fill form-icon"></i>
								<label class="form-label">Rol <span>*</span></label>
								<select th:field="*{rol.id}" class="form-select" required>
									<option value="">Seleccione...</option>
									<option th:each="r : ${roles}" th:value="${r.id}" th:text="${r.nombre}"></option>
								</select>
								<div class="text-danger small" th:errors="*{rol.id}"></div>
							</div>

							<!-- ROL AUTOMÁTICO ADOPTANTE -->
							<input type="hidden" th:if="${!isAdmin}" name="rolId" value="2"/>
							<input type="hidden" name="estadoId" value="ACTIVO"/>

							<div class="col-12 mt-4 d-flex justify-content-end">
								<button class="btn btn-primary me-2" type="submit">Registrar</button>
								<a th:href="@{/}" class="btn btn-secondary">Cancelar</a>
							</div>

						</div>

						<div th:if="${#fields.hasErrors('*')}">
							<script>
								Swal.fire({ icon:'warning', title:'Formulario inválido', text:'Revisa los campos obligatorios' });
							</script>
						</div>

					</form>

				</div>
			</div>
		</div>
	</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/util/util.js"></script>
</body>
</html>
