<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Solicitud de adopción</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <style>
        .lp-header { background:#3f558f; color:#fff; }
        .lp-step { border-top: 2px solid #d9d9d9; padding-top: 10px; color:#6b7280; }
        .lp-step.active { border-top-color:#3f558f; color:#111827; font-weight:600; }
        .lp-step .num { width:28px;height:28px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;background:#9ca3af;color:#fff;font-size:14px; }
        .lp-step.active .num { background:#3f558f; }
        .lp-section { display:none; }
        .lp-section.active { display:block; }
    </style>
</head>
<body class="bg-light">
<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="container-fluid px-0">
    <div class="lp-header py-2 px-3">
        <h1 class="h3 m-0 text-uppercase">Solicitud de adopción de <span th:text="${mascota.nombre}">Mascota</span></h1>
    </div>
</div>

<div class="container py-4">
    <form th:action="@{/adopcion/solicitar}" method="post" id="solicitudForm">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <input type="hidden" name="mascota.id" th:value="${mascota.id}"/>

        <div class="row g-3 mb-4 text-center">
            <div class="col-6 col-lg-3 lp-step active" data-step="1"><span class="num">1</span><div>Datos del contacto</div></div>
            <div class="col-6 col-lg-3 lp-step" data-step="2"><span class="num">2</span><div>Datos del hogar</div></div>
            <div class="col-6 col-lg-3 lp-step" data-step="3"><span class="num">3</span><div>Intereses del adoptante</div></div>
            <div class="col-6 col-lg-3 lp-step" data-step="4"><span class="num">4</span><div>Resumen</div></div>
        </div>

        <section class="lp-section active" data-step="1">
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">¿Por qué deseas tener una mascota?</label>
                    <textarea class="form-control" name="pqAdoptar" rows="4" minlength="20" maxlength="600" required></textarea>
                </div>
                <div class="col-md-6">
                    <label class="form-label">¿Cuánto tiempo del día podrás dedicarle?</label>
                    <select class="form-select" name="tiempoDedicado" required>
                        <option value="" selected disabled>Selecciona una opción</option>
                        <option>1 a 3 horas</option>
                        <option>3 a 8 horas</option>
                        <option>Todo el día</option>
                        <option>Menos de 1 a 3 horas</option>
                    </select>
                </div>
            </div>
        </section>

        <section class="lp-section" data-step="2">
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">¿Vives en casa o departamento?</label>
                    <select class="form-select" name="tipoVivienda" required>
                        <option value="" selected disabled>Selecciona una opción</option>
                        <option>Casa con patio</option>
                        <option>Casa sin patio</option>
                        <option>Departamento</option>
                        <option>Otro</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label">¿Hay niños u otras mascotas?</label>
                    <select class="form-select" name="ninosOtraMascotas" required>
                        <option value="" selected disabled>Selecciona una opción</option>
                        <option>No</option>
                        <option>Niños en casa</option>
                        <option>Otras mascotas</option>
                        <option>Niños y mascotas</option>
                    </select>
                </div>
            </div>
        </section>

        <section class="lp-section" data-step="3">
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">¿Experiencia previa con mascotas?</label>
                    <select class="form-select" name="experiencia" required>
                        <option value="" selected disabled>Selecciona una opción</option>
                        <option>Primera vez</option>
                        <option>Experiencia previa</option>
                        <option>Actualmente tengo mascotas</option>
                        <option>Experiencia avanzada</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label">¿Puedes cubrir los costos básicos?</label>
                    <select class="form-select" name="cubrirCostos" required>
                        <option value="" selected disabled>Selecciona una opción</option>
                        <option>Sí</option>
                        <option>No</option>
                        <option>Necesito orientación</option>
                    </select>
                </div>
                <div class="col-12">
                    <label class="form-label">Describe tu plan de cuidado de la mascota</label>
                    <textarea class="form-control" name="planMascota" rows="4" minlength="20" maxlength="600" required></textarea>
                </div>
            </div>
        </section>

        <section class="lp-section" data-step="4">
            <div class="row g-3">
                <div class="col-12">
                    <label class="form-label">Información adicional (opcional)</label>
                    <textarea class="form-control" name="infoAdicional" rows="4" maxlength="600"></textarea>
                </div>
                <div class="col-12">
                    <div class="alert alert-info mb-0">
                        Al enviar, tu solicitud quedará en estado <strong>PENDIENTE</strong> para revisión del gestor.
                    </div>
                </div>
            </div>
        </section>

        <div class="d-flex gap-2 mt-4">
            <button class="btn btn-outline-secondary" type="button" id="prevBtn">Atrás</button>
            <button class="btn btn-primary" type="button" id="nextBtn">Siguiente</button>
            <button class="btn btn-success ms-auto d-none" type="submit" id="submitBtn">Enviar solicitud</button>
        </div>
    </form>
</div>

<script>
(() => {
    const steps = [...document.querySelectorAll('.lp-section')];
    const stepIndicators = [...document.querySelectorAll('.lp-step')];
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const submitBtn = document.getElementById('submitBtn');
    let current = 0;

    const update = () => {
        steps.forEach((s, i) => s.classList.toggle('active', i === current));
        stepIndicators.forEach((s, i) => s.classList.toggle('active', i === current));
        prevBtn.disabled = current === 0;
        nextBtn.classList.toggle('d-none', current === steps.length - 1);
        submitBtn.classList.toggle('d-none', current !== steps.length - 1);
    };

    const validateCurrentStep = () => {
        const fields = steps[current].querySelectorAll('input, select, textarea');
        for (const field of fields) {
            if (!field.checkValidity()) {
                field.reportValidity();
                return false;
            }
        }
        return true;
    };

    nextBtn.addEventListener('click', () => {
        if (!validateCurrentStep()) return;
        current = Math.min(current + 1, steps.length - 1);
        update();
    });

    prevBtn.addEventListener('click', () => {
        current = Math.max(current - 1, 0);
        update();
    });

    update();
})();
</script>

</body>
</html>
