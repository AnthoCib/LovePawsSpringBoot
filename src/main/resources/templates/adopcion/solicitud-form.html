<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Solicitud de adopción</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <style>
        .lp-header { background:#3f558f; color:#fff; }
        .lp-step { border-top: 2px solid #d9d9d9; padding-top: 10px; color:#6b7280; }
        .lp-step.active { border-top-color:#3f558f; color:#111827; font-weight:600; }
        .lp-step .num { width:28px;height:28px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;background:#9ca3af;color:#fff;font-size:14px; }
        .lp-step.active .num { background:#3f558f; }
        .lp-section { display:none; }
        .lp-section.active { display:block; }
        .lp-question { margin-bottom: 1rem; }
    </style>
</head>
<body class="bg-light">
<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="container-fluid px-0">
    <div class="lp-header py-2 px-3">
        <h1 class="h3 m-0 text-uppercase">Solicitud de adopción de <span th:text="${mascota.nombre}">Mascota</span></h1>
    </div>
</div>

<div class="container py-4">
    <form th:action="@{/adopcion/solicitar}" method="post" id="solicitudForm">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <input type="hidden" name="mascota.id" th:value="${mascota.id}"/>

        <div class="row g-3 mb-4 text-center">
            <div class="col-6 col-lg-3 lp-step active" data-step="1"><span class="num">1</span><div>Datos del contacto</div></div>
            <div class="col-6 col-lg-3 lp-step" data-step="2"><span class="num">2</span><div>Datos del hogar</div></div>
            <div class="col-6 col-lg-3 lp-step" data-step="3"><span class="num">3</span><div>Intereses del adoptante</div></div>
            <div class="col-6 col-lg-3 lp-step" data-step="4"><span class="num">4</span><div>Cuidados y compromiso</div></div>
        </div>

        <section class="lp-section active" data-step="1">
            <div class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">Solicitante</label>
                    <input class="form-control" type="text" th:value="${usuario != null ? usuario.nombre : ''}" readonly>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Celular</label>
                    <input class="form-control" type="text" th:value="${usuario != null ? usuario.telefono : ''}" readonly>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Correo electrónico</label>
                    <input class="form-control" type="email" th:value="${usuario != null ? usuario.correo : ''}" readonly>
                </div>
                <div class="col-md-6">
                    <label class="form-label">¿Por qué deseas tener una mascota?</label>
                    <textarea class="form-control" name="pqAdoptar" rows="4" minlength="20" maxlength="600" required></textarea>
                </div>
                <div class="col-md-6">
                    <label class="form-label">¿Cuánto tiempo del día podrás dedicarle?</label>
                    <select class="form-select" name="tiempoDedicado" required>
                        <option value="" selected disabled>Selecciona una opción</option>
                        <option>1 a 3 horas</option>
                        <option>3 a 8 horas</option>
                        <option>Todo el día</option>
                        <option>Menos de 1 a 3 horas</option>
                    </select>
                </div>
            </div>
        </section>

        <section class="lp-section" data-step="2">
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">¿Vives en casa o departamento?</label>
                    <select class="form-select" name="tipoVivienda" required>
                        <option value="" selected disabled>Selecciona una opción</option>
                        <option>Casa con patio</option>
                        <option>Casa sin patio</option>
                        <option>Departamento</option>
                        <option>Otro</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label">¿Hay niños u otras mascotas?</label>
                    <select class="form-select" name="ninosOtraMascotas" required>
                        <option value="" selected disabled>Selecciona una opción</option>
                        <option>No</option>
                        <option>Niños en casa</option>
                        <option>Otras mascotas</option>
                        <option>Niños y mascotas</option>
                    </select>
                </div>
                <div class="col-12">
                    <label class="form-label">¿Con qué frecuencia saldrá a pasear la mascota? ¿Quién será el encargado?</label>
                    <textarea class="form-control" name="extraPaseos" rows="3" required></textarea>
                </div>
                <div class="col-12">
                    <label class="form-label">¿A qué ambientes de su vivienda tiene permitido ingresar la mascota?</label>
                    <textarea class="form-control" name="extraAmbientes" rows="3" required></textarea>
                </div>
            </div>
        </section>

        <section class="lp-section" data-step="3">
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">¿Experiencia previa con mascotas?</label>
                    <select class="form-select" name="experiencia" required>
                        <option value="" selected disabled>Selecciona una opción</option>
                        <option>Primera vez</option>
                        <option>Experiencia previa</option>
                        <option>Actualmente tengo mascotas</option>
                        <option>Experiencia avanzada</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label">¿Puedes cubrir los costos básicos?</label>
                    <select class="form-select" name="cubrirCostos" required>
                        <option value="" selected disabled>Selecciona una opción</option>
                        <option>Sí</option>
                        <option>No</option>
                        <option>Necesito orientación</option>
                    </select>
                </div>
                <div class="col-12">
                    <label class="form-label">Describe tu plan de cuidado de la mascota</label>
                    <textarea class="form-control" name="planMascota" rows="4" minlength="20" maxlength="600" required></textarea>
                </div>
                <div class="col-12">
                    <label class="form-label">Cuando estés fuera de casa, ¿dónde estará tu mascota?</label>
                    <textarea class="form-control" name="extraFueraCasa" rows="3" required></textarea>
                </div>
            </div>
        </section>

        <section class="lp-section" data-step="4">
            <div class="row g-3">
                <div class="col-md-6 lp-question">
                    <label class="form-label d-block">¿Podrá cuidar a su mascota de aquí a un año?</label>
                    <div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="extraCuidarUnAnio" value="Sí" required><label class="form-check-label">Sí</label></div>
                    <div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="extraCuidarUnAnio" value="No" required><label class="form-check-label">No</label></div>
                </div>
                <div class="col-md-6 lp-question">
                    <label class="form-label d-block">¿Y de aquí a cinco o diez años?</label>
                    <div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="extraCuidarDiezAnios" value="Sí" required><label class="form-check-label">Sí</label></div>
                    <div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="extraCuidarDiezAnios" value="No" required><label class="form-check-label">No</label></div>
                </div>
                <div class="col-md-6 lp-question">
                    <label class="form-label">¿Qué harás con tu mascota si sales de viaje algunas semanas?</label>
                    <textarea class="form-control" name="extraViajeSemanas" rows="2" required></textarea>
                </div>
                <div class="col-md-6 lp-question">
                    <label class="form-label">¿Qué harás con tu mascota si sales de viaje uno o más meses?</label>
                    <textarea class="form-control" name="extraViajeMeses" rows="2" required></textarea>
                </div>
                <div class="col-md-6 lp-question">
                    <label class="form-label">¿Qué harías si por descuido la mascota escapa de casa?</label>
                    <textarea class="form-control" name="extraEscape" rows="2" required></textarea>
                </div>
                <div class="col-md-6 lp-question">
                    <label class="form-label">¿Qué harás si muestra un problema de comportamiento?</label>
                    <textarea class="form-control" name="extraComportamiento" rows="2" required></textarea>
                </div>
                <div class="col-12">
                    <label class="form-label">Información adicional (opcional)</label>
                    <textarea class="form-control" name="infoAdicional" id="infoAdicional" rows="3" maxlength="1200"></textarea>
                </div>

                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body row g-3 align-items-center">
                            <div class="col-md-7">
                                <h2 class="h4 mb-2">Resultados de la solicitud</h2>
                                <p class="mb-1">Te enviaremos un correo con el detalle de la solicitud de adopción.</p>
                                <p class="mb-1">Una vez aceptada por parte del albergue, se te notificará por correo electrónico.</p>
                                <p class="mb-0">También te indicaremos los siguientes pasos para concluir el proceso.</p>
                            </div>
                            <div class="col-md-5 text-center">
                                <div class="display-1 text-success">✓</div>
                                <div class="fw-semibold">¡Gracias por adoptar con responsabilidad!</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="d-flex gap-2 mt-4">
            <a class="btn btn-outline-secondary" th:href="@{'/mascotas/' + ${mascota.id}}">Cancelar</a>
            <button class="btn btn-outline-secondary" type="button" id="prevBtn">Atrás</button>
            <button class="btn btn-primary" type="button" id="nextBtn">Siguiente</button>
            <button class="btn btn-success ms-auto d-none" type="submit" id="submitBtn">Finalizar</button>
        </div>
    </form>
</div>

<script>
(() => {
    const steps = [...document.querySelectorAll('.lp-section')];
    const stepIndicators = [...document.querySelectorAll('.lp-step')];
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const submitBtn = document.getElementById('submitBtn');
    const form = document.getElementById('solicitudForm');
    let current = 0;

    const update = () => {
        steps.forEach((s, i) => s.classList.toggle('active', i === current));
        stepIndicators.forEach((s, i) => s.classList.toggle('active', i === current));
        prevBtn.disabled = current === 0;
        nextBtn.classList.toggle('d-none', current === steps.length - 1);
        submitBtn.classList.toggle('d-none', current !== steps.length - 1);
    };

    const validateCurrentStep = () => {
        const fields = steps[current].querySelectorAll('input, select, textarea');
        for (const field of fields) {
            if (!field.checkValidity()) {
                field.reportValidity();
                return false;
            }
        }
        return true;
    };

    nextBtn.addEventListener('click', () => {
        if (!validateCurrentStep()) return;
        current = Math.min(current + 1, steps.length - 1);
        update();
    });

    prevBtn.addEventListener('click', () => {
        current = Math.max(current - 1, 0);
        update();
    });

    form.addEventListener('submit', () => {
        const info = document.getElementById('infoAdicional');
        const extra = [
            'Ambientes permitidos: ' + (form.extraAmbientes?.value || '-'),
            'Paseos y encargado: ' + (form.extraPaseos?.value || '-'),
            'Fuera de casa: ' + (form.extraFueraCasa?.value || '-'),
            'Cuidará en 1 año: ' + (form.extraCuidarUnAnio?.value || '-'),
            'Cuidará en 5-10 años: ' + (form.extraCuidarDiezAnios?.value || '-'),
            'Plan viaje semanas: ' + (form.extraViajeSemanas?.value || '-'),
            'Plan viaje meses: ' + (form.extraViajeMeses?.value || '-'),
            'Acción ante escape: ' + (form.extraEscape?.value || '-'),
            'Manejo de comportamiento: ' + (form.extraComportamiento?.value || '-')
        ].join('\n');
        info.value = (info.value ? info.value + '\n\n' : '') + '[Detalle ampliado]\n' + extra;
    });

    update();
})();
</script>

</body>
</html>
