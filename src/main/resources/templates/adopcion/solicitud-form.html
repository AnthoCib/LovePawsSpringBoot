<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Solicitud de adopción</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <style>
        :root { --lp-primary:#3f558f; --lp-primary-dark:#2f4478; --lp-muted:#e5e7eb; }
        body { background:#f3f4f6; }
        .lp-header { background:var(--lp-primary); color:#fff; }
        .lp-wrap { background:#fff; border:1px solid #e5e7eb; }
        .lp-step { border-top:2px solid #d1d5db; padding-top:8px; color:#6b7280; font-size:.9rem; }
        .lp-step .num { width:24px; height:24px; border-radius:50%; display:inline-flex; align-items:center; justify-content:center; background:#9ca3af; color:#fff; font-size:.8rem; }
        .lp-step.active { border-top-color:var(--lp-primary); color:#111827; }
        .lp-step.active .num { background:var(--lp-primary); }
        .lp-section { display:none; }
        .lp-section.active { display:block; }
        .q-title { font-weight:500; margin-bottom:.4rem; }
        .q-block { margin-bottom:1rem; }
        .result-card { border:1px solid #e5e7eb; background:#fafafa; }
        .ok-circle { width:140px; height:140px; border-radius:50%; border:8px solid #22c55e; color:#22c55e; display:flex; align-items:center; justify-content:center; font-size:4rem; margin:0 auto; }
    </style>
</head>
<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="container-fluid px-0">
    <div class="lp-header py-2 px-3">
        <h1 class="h3 m-0 text-uppercase">SOLICITUD DE ADOPCIÓN DE <span th:text="${mascota.nombre}">MASCOTA</span></h1>
    </div>
</div>

<div class="container py-4">
    <div class="lp-wrap p-3 p-md-4">
        <form th:action="@{/adopcion/solicitar}" method="post" id="solicitudForm">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <input type="hidden" name="mascota.id" th:value="${mascota.id}"/>

            <div class="row g-3 mb-4 text-center">
                <div class="col-6 col-lg-3 lp-step active" data-step="1"><span class="num">1</span><div>Datos del contacto</div></div>
                <div class="col-6 col-lg-3 lp-step" data-step="2"><span class="num">2</span><div>Datos del nuevo hogar</div></div>
                <div class="col-6 col-lg-3 lp-step" data-step="3"><span class="num">3</span><div>Intereses del adoptante</div></div>
                <div class="col-6 col-lg-3 lp-step" data-step="4"><span class="num">4</span><div>Resultados</div></div>
            </div>

            <section class="lp-section active" data-step="1">
                <div class="row g-3 mb-3">
                    <div class="col-md-4"><label class="form-label small text-muted mb-1">SOLICITANTE</label><input class="form-control" th:value="${usuario != null ? usuario.nombre : ''}" readonly></div>
                    <div class="col-md-4"><label class="form-label small text-muted mb-1">CELULAR</label><input class="form-control" th:value="${usuario != null ? usuario.telefono : ''}" readonly></div>
                    <div class="col-md-4"><label class="form-label small text-muted mb-1">CORREO ELECTRÓNICO</label><input class="form-control" th:value="${usuario != null ? usuario.correo : ''}" readonly></div>
                </div>

                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="q-block">
                            <div class="q-title">9. ¿Cuántas horas del día deberá pasar la mascota sola?</div>
                            <div class="form-check"><input class="form-check-input" type="radio" name="tiempoDedicado" value="1 a 3 horas" required><label class="form-check-label">1 a 3 horas</label></div>
                            <div class="form-check"><input class="form-check-input" type="radio" name="tiempoDedicado" value="3 a 8 horas" required><label class="form-check-label">3 a 8 horas</label></div>
                            <div class="form-check"><input class="form-check-input" type="radio" name="tiempoDedicado" value="Todo el día" required><label class="form-check-label">Todo el día</label></div>
                            <div class="form-check"><input class="form-check-input" type="radio" name="tiempoDedicado" value="Menos de 1 a 3 horas" required><label class="form-check-label">Menos de 1 a 3 horas</label></div>
                        </div>
                        <div class="q-block">
                            <div class="q-title">10. ¿Por qué desea tener una mascota?</div>
                            <textarea class="form-control" name="pqAdoptar" minlength="20" maxlength="600" rows="3" required></textarea>
                        </div>
                        <div class="q-block">
                            <div class="q-title">11. ¿Ha tenido mascota antes? ¿Qué pasó con ella?</div>
                            <select class="form-select" name="experiencia" required>
                                <option value="" selected disabled>Selecciona una opción</option>
                                <option>Primera vez</option>
                                <option>Sí, sigue viviendo conmigo</option>
                                <option>Sí, falleció por edad</option>
                                <option>Sí, fue dada en adopción</option>
                            </select>
                        </div>
                        <div class="q-block">
                            <div class="q-title">12. ¿Conoces los cuidados que requiere un animal doméstico? Descríbelos.</div>
                            <textarea class="form-control" name="planMascota" minlength="20" maxlength="600" rows="3" required></textarea>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="q-block">
                            <div class="q-title">13. ¿Tienes pensado realizar algún viaje de estudio o trabajo en los próximos 2 años?</div>
                            <div class="form-check"><input class="form-check-input" type="radio" name="extraViajePlan" value="Sí" required><label class="form-check-label">Sí</label></div>
                            <div class="form-check"><input class="form-check-input" type="radio" name="extraViajePlan" value="No" required><label class="form-check-label">No</label></div>
                        </div>
                        <div class="q-block">
                            <div class="q-title">14. ¿Cuándo y por cuánto tiempo?</div>
                            <textarea class="form-control" name="extraViajeTiempo" rows="2" required></textarea>
                        </div>
                        <div class="q-block">
                            <div class="q-title">15. ¿Tienes tiempo y paciencia para educar una mascota?</div>
                            <div class="form-check"><input class="form-check-input" type="radio" name="extraEducar" value="Sí" required><label class="form-check-label">Sí</label></div>
                            <div class="form-check"><input class="form-check-input" type="radio" name="extraEducar" value="No" required><label class="form-check-label">No</label></div>
                        </div>
                        <div class="q-block">
                            <div class="q-title">16. ¿Quién será el responsable directo de la mascota?</div>
                            <textarea class="form-control" name="extraResponsable" rows="2" required></textarea>
                        </div>
                    </div>
                </div>
            </section>

            <section class="lp-section" data-step="2">
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="q-block"><div class="q-title">1. ¿Vives en casa o departamento?</div><select class="form-select" name="tipoVivienda" required><option value="" selected disabled>Selecciona</option><option>Casa con patio</option><option>Casa sin patio</option><option>Departamento</option><option>Otro</option></select></div>
                        <div class="q-block"><div class="q-title">2. ¿De qué tamaño es tu vivienda?</div><textarea class="form-control" name="extraTamanoCasa" rows="2" required></textarea></div>
                        <div class="q-block"><div class="q-title">3. ¿Tu vivienda es propia o alquilada?</div><textarea class="form-control" name="extraViviendaPropia" rows="2" required></textarea></div>
                        <div class="q-block"><div class="q-title">4. ¿Tu vivienda tiene rejas/mallas de seguridad?</div><div class="form-check"><input class="form-check-input" type="radio" name="extraSeguridadCasa" value="Sí" required><label class="form-check-label">Sí</label></div><div class="form-check"><input class="form-check-input" type="radio" name="extraSeguridadCasa" value="No" required><label class="form-check-label">No</label></div></div>
                    </div>
                    <div class="col-md-6">
                        <div class="q-block"><div class="q-title">5. ¿Tu vivienda tiene jardín o patio?</div><div class="form-check"><input class="form-check-input" type="radio" name="extraPatio" value="Sí" required><label class="form-check-label">Sí</label></div><div class="form-check"><input class="form-check-input" type="radio" name="extraPatio" value="No" required><label class="form-check-label">No</label></div></div>
                        <div class="q-block"><div class="q-title">6. ¿Quiénes viven contigo?</div><textarea class="form-control" name="ninosOtraMascotas" rows="2" required></textarea></div>
                        <div class="q-block"><div class="q-title">7. ¿Alguno es alérgico al pelo de mascota?</div><div class="form-check"><input class="form-check-input" type="radio" name="extraAlergia" value="Sí" required><label class="form-check-label">Sí</label></div><div class="form-check"><input class="form-check-input" type="radio" name="extraAlergia" value="No" required><label class="form-check-label">No</label></div></div>
                        <div class="q-block"><div class="q-title">8. ¿Tienes alguna mascota en casa?</div><div class="form-check"><input class="form-check-input" type="radio" name="extraMascotaCasa" value="Sí" required><label class="form-check-label">Sí</label></div><div class="form-check"><input class="form-check-input" type="radio" name="extraMascotaCasa" value="No" required><label class="form-check-label">No</label></div></div>
                    </div>
                </div>
            </section>

            <section class="lp-section" data-step="3">
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="q-block"><div class="q-title">17. ¿A qué ambientes de su vivienda tiene permitido ingresar la mascota?</div><textarea class="form-control" name="extraAmbientes" rows="2" required></textarea></div>
                        <div class="q-block"><div class="q-title">18. ¿Con qué frecuencia saldrá a pasear la mascota? ¿Quién será el encargado?</div><textarea class="form-control" name="extraPaseos" rows="2" required></textarea></div>
                        <div class="q-block"><div class="q-title">19. ¿Cuántas horas de juego podrá proveer dentro de casa?</div><textarea class="form-control" name="extraHorasJuego" rows="2" required></textarea></div>
                        <div class="q-block"><div class="q-title">20. Si por descuido se escapara, ¿qué haría usted?</div><textarea class="form-control" name="extraEscape" rows="2" required></textarea></div>
                        <div class="q-block"><div class="q-title">26. ¿Qué harás con tu mascota si mostrara algún problema de comportamiento?</div><textarea class="form-control" name="extraComportamiento" rows="2" required></textarea></div>
                    </div>
                    <div class="col-md-6">
                        <div class="q-block"><div class="q-title">21. ¿Podrá cuidar a su mascota de aquí a un año?</div><div class="form-check"><input class="form-check-input" type="radio" name="extraCuidarUnAnio" value="Sí" required><label class="form-check-label">Sí</label></div><div class="form-check"><input class="form-check-input" type="radio" name="extraCuidarUnAnio" value="No" required><label class="form-check-label">No</label></div></div>
                        <div class="q-block"><div class="q-title">22. Cuando estés fuera de casa, ¿dónde estará tu mascota?</div><textarea class="form-control" name="extraFueraCasa" rows="2" required></textarea></div>
                        <div class="q-block"><div class="q-title">23. ¿Y de aquí a cinco o diez años? ¿Podrá cuidarla?</div><div class="form-check"><input class="form-check-input" type="radio" name="extraCuidarDiezAnios" value="Sí" required><label class="form-check-label">Sí</label></div><div class="form-check"><input class="form-check-input" type="radio" name="extraCuidarDiezAnios" value="No" required><label class="form-check-label">No</label></div></div>
                        <div class="q-block"><div class="q-title">24. ¿Qué harás con tu mascota si sales de viaje algunas semanas?</div><textarea class="form-control" name="extraViajeSemanas" rows="2" required></textarea></div>
                        <div class="q-block"><div class="q-title">25. ¿Qué harás con tu mascota si sales de viaje uno o más meses?</div><textarea class="form-control" name="extraViajeMeses" rows="2" required></textarea></div>
                    </div>
                </div>
            </section>

            <section class="lp-section" data-step="4">
                <div class="result-card p-3 p-md-4">
                    <div class="row g-4 align-items-center">
                        <div class="col-md-7">
                            <h2 class="h1 fw-semibold mb-3">RESULTADOS DE LA SOLICITUD</h2>
                            <div class="mb-2"><label class="small text-muted">SOLICITANTE</label><input class="form-control" th:value="${usuario != null ? usuario.nombre : ''}" readonly></div>
                            <div class="mb-2"><label class="small text-muted">CELULAR</label><input class="form-control" th:value="${usuario != null ? usuario.telefono : ''}" readonly></div>
                            <div class="mb-3"><label class="small text-muted">CORREO ELECTRÓNICO</label><input class="form-control" th:value="${usuario != null ? usuario.correo : ''}" readonly></div>
                            <p class="mb-1">Te enviaremos un correo con el detalle de la solicitud de adopción.</p>
                            <p class="mb-1">Una vez aceptada la solicitud por parte del albergue se te notificará por correo electrónico.</p>
                            <p class="mb-0">Te indicaremos también los siguientes pasos para concluir la adopción. Muchas gracias.</p>
                        </div>
                        <div class="col-md-5 text-center">
                            <h3 class="display-6 fw-semibold">¡Felicitaciones!</h3>
                            <div class="ok-circle my-3">✓</div>
                            <p class="mb-0">Los resultados de la evaluación fueron exitosos.<br/>Ud. calificó exitosamente para adoptar.</p>
                        </div>
                    </div>
                </div>
                <textarea class="form-control mt-3" name="infoAdicional" id="infoAdicional" rows="3" placeholder="Información adicional (opcional)"></textarea>
            </section>

            <div class="d-flex gap-2 mt-4">
                <a class="btn btn-outline-secondary" th:href="@{'/mascotas/' + ${mascota.id}}">Cancelar</a>
                <button class="btn btn-outline-secondary" type="button" id="prevBtn">Atrás</button>
                <button class="btn btn-primary" type="button" id="nextBtn">Siguiente</button>
                <button class="btn btn-success ms-auto d-none" type="submit" id="submitBtn">Finalizar</button>
            </div>
        </form>
    </div>
</div>

<script>
(() => {
    const steps = [...document.querySelectorAll('.lp-section')];
    const stepIndicators = [...document.querySelectorAll('.lp-step')];
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const submitBtn = document.getElementById('submitBtn');
    const form = document.getElementById('solicitudForm');
    let current = 0;

    const update = () => {
        steps.forEach((s, i) => s.classList.toggle('active', i === current));
        stepIndicators.forEach((s, i) => s.classList.toggle('active', i === current));
        prevBtn.disabled = current === 0;
        nextBtn.classList.toggle('d-none', current === steps.length - 1);
        submitBtn.classList.toggle('d-none', current !== steps.length - 1);
    };

    const validateCurrentStep = () => {
        const fields = steps[current].querySelectorAll('input, select, textarea');
        for (const field of fields) {
            if (!field.checkValidity()) {
                field.reportValidity();
                return false;
            }
        }
        return true;
    };

    nextBtn.addEventListener('click', () => {
        if (!validateCurrentStep()) return;
        current = Math.min(current + 1, steps.length - 1);
        update();
    });

    prevBtn.addEventListener('click', () => {
        current = Math.max(current - 1, 0);
        update();
    });

    form.addEventListener('submit', () => {
        const info = document.getElementById('infoAdicional');
        const extra = [
            'Plan de viaje (2 años): ' + (form.extraViajePlan?.value || '-'),
            'Tiempo de viaje: ' + (form.extraViajeTiempo?.value || '-'),
            'Paciencia para educar: ' + (form.extraEducar?.value || '-'),
            'Responsable directo: ' + (form.extraResponsable?.value || '-'),
            'Ambientes permitidos: ' + (form.extraAmbientes?.value || '-'),
            'Paseos y encargado: ' + (form.extraPaseos?.value || '-'),
            'Horas de juego: ' + (form.extraHorasJuego?.value || '-'),
            'Qué haría ante escape: ' + (form.extraEscape?.value || '-'),
            'Manejo de comportamiento: ' + (form.extraComportamiento?.value || '-'),
            'Fuera de casa: ' + (form.extraFueraCasa?.value || '-'),
            'Viaje semanas: ' + (form.extraViajeSemanas?.value || '-'),
            'Viaje meses: ' + (form.extraViajeMeses?.value || '-')
        ].join('\n');
        info.value = (info.value ? info.value + '\n\n' : '') + '[Detalle ampliado]\n' + extra;
    });

    update();
})();
</script>

</body>
</html>
