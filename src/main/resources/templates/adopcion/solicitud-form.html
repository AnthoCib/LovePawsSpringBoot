<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Solicitud de adopción</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link th:href="@{/css/admin.css}" rel="stylesheet"/>
    <style>
        :root { --lp-primary:#3f558f; --lp-primary-dark:#2f4478; }
        body { background:#f3f4f6; }
        .lp-header { background:var(--lp-primary); color:#fff; }
        .lp-wrap { background:#fff; border:1px solid #e5e7eb; }
        .lp-step { border-top:2px solid #d1d5db; padding-top:8px; color:#6b7280; font-size:.9rem; }
        .lp-step .num { width:24px; height:24px; border-radius:50%; display:inline-flex; align-items:center; justify-content:center; background:#9ca3af; color:#fff; font-size:.8rem; }
        .lp-step.active { border-top-color:var(--lp-primary); color:#111827; }
        .lp-step.active .num { background:var(--lp-primary); }
        .lp-section { display:none; }
        .lp-section.active { display:block; }
        .q-title { font-weight:500; margin-bottom:.4rem; }
        .q-block { margin-bottom:1rem; }
    </style>
</head>
<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="container-fluid px-0">
    <div class="lp-header py-2 px-3">
        <h1 class="h3 m-0 text-uppercase">SOLICITUD DE ADOPCIÓN DE <span th:text="${mascota.nombre}">MASCOTA</span></h1>
    </div>
</div>

<div class="container py-4">
    <div class="lp-wrap p-3 p-md-4">
        <form th:action="@{/adopcion/solicitar}" method="post" id="solicitudForm">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <input type="hidden" name="mascota.id" th:value="${mascota.id}"/>

            <div class="row g-3 mb-4 text-center">
                <div class="col-6 col-lg-3 lp-step active" data-step="1"><span class="num">1</span><div>Datos del contacto</div></div>
                <div class="col-6 col-lg-3 lp-step" data-step="2"><span class="num">2</span><div>Datos del hogar</div></div>
                <div class="col-6 col-lg-3 lp-step" data-step="3"><span class="num">3</span><div>Intereses del adoptante</div></div>
                <div class="col-6 col-lg-3 lp-step" data-step="4"><span class="num">4</span><div>Confirmación</div></div>
            </div>

            <section class="lp-section active" data-step="1">
                <div class="row g-3 mb-3">
                    <div class="col-md-4"><label class="form-label small text-muted mb-1">SOLICITANTE</label><input class="form-control" th:value="${usuario != null ? usuario.nombre : ''}" readonly></div>
                    <div class="col-md-4"><label class="form-label small text-muted mb-1">CELULAR</label><input class="form-control" th:value="${usuario != null ? usuario.telefono : ''}" readonly></div>
                    <div class="col-md-4"><label class="form-label small text-muted mb-1">CORREO ELECTRÓNICO</label><input class="form-control" th:value="${usuario != null ? usuario.correo : ''}" readonly></div>
                </div>

                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="q-block">
                            <div class="q-title">1. ¿Cuántas horas al día podrá dedicar a la mascota?</div>
                            <div class="form-check"><input class="form-check-input" type="radio" name="tiempoDedicado" value="1 a 3 horas" required><label class="form-check-label">1 a 3 horas</label></div>
                            <div class="form-check"><input class="form-check-input" type="radio" name="tiempoDedicado" value="3 a 8 horas" required><label class="form-check-label">3 a 8 horas</label></div>
                            <div class="form-check"><input class="form-check-input" type="radio" name="tiempoDedicado" value="Todo el día" required><label class="form-check-label">Todo el día</label></div>
                        </div>

                        <div class="q-block">
                            <div class="q-title">2. ¿Cuál es su principal motivación para adoptar?</div>
                            <select class="form-select" name="pqAdoptar" required>
                                <option value="" selected disabled>Selecciona una opción</option>
                                <option>Compañía y bienestar emocional</option>
                                <option>Amor por los animales rescatados</option>
                                <option>Mi familia desea integrar una mascota</option>
                                <option>Quiero brindar un hogar responsable</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="q-block">
                            <div class="q-title">3. ¿Ha tenido mascotas anteriormente?</div>
                            <select class="form-select" name="experiencia" required>
                                <option value="" selected disabled>Selecciona una opción</option>
                                <option>Primera vez</option>
                                <option>Sí, actualmente tengo mascota(s)</option>
                                <option>Sí, tuve antes y tengo experiencia</option>
                            </select>
                        </div>

                        <div class="q-block">
                            <div class="q-title">4. ¿Puede cubrir alimentación, salud y cuidados básicos?</div>
                            <select class="form-select" name="cubrirCostos" required>
                                <option value="" selected disabled>Selecciona una opción</option>
                                <option>Sí, completamente</option>
                                <option>Sí, con apoyo familiar</option>
                                <option>Necesito orientación</option>
                            </select>
                        </div>
                    </div>
                </div>
            </section>

            <section class="lp-section" data-step="2">
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="q-block"><div class="q-title">5. Tipo de vivienda</div><select class="form-select" name="tipoVivienda" required><option value="" selected disabled>Selecciona</option><option>Casa con patio</option><option>Casa sin patio</option><option>Departamento</option></select></div>
                        <div class="q-block"><div class="q-title">6. ¿Hay niños u otras mascotas en casa?</div><select class="form-select" name="ninosOtraMascotas" required><option value="" selected disabled>Selecciona</option><option>No</option><option>Niños en casa</option><option>Otras mascotas</option><option>Niños y mascotas</option></select></div>
                        <div class="q-block"><div class="q-title">7. ¿Tu vivienda tiene zonas seguras para evitar escapes?</div><div class="form-check"><input class="form-check-input" type="radio" name="extraSeguridad" value="Sí" required><label class="form-check-label">Sí</label></div><div class="form-check"><input class="form-check-input" type="radio" name="extraSeguridad" value="No" required><label class="form-check-label">No</label></div></div>
                    </div>
                    <div class="col-md-6">
                        <div class="q-block"><div class="q-title">8. ¿Quién será el responsable principal del cuidado?</div><select class="form-select" name="extraResponsable" required><option value="" selected disabled>Selecciona</option><option>Yo</option><option>Yo y mi pareja</option><option>Toda la familia</option></select></div>
                        <div class="q-block"><div class="q-title">9. ¿Con qué frecuencia paseará a la mascota?</div><select class="form-select" name="extraPaseos" required><option value="" selected disabled>Selecciona</option><option>2 veces al día</option><option>1 vez al día</option><option>Días alternos</option></select></div>
                        <div class="q-block"><div class="q-title">10. ¿Dónde permanecerá la mascota cuando salga de casa?</div><select class="form-select" name="extraFueraCasa" required><option value="" selected disabled>Selecciona</option><option>Dentro de casa</option><option>Con familiar/cuidador</option><option>Guardería temporal</option></select></div>
                    </div>
                </div>
            </section>

            <section class="lp-section" data-step="3">
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="q-block"><div class="q-title">11. ¿Podrá mantener el cuidado por al menos 1 año?</div><div class="form-check"><input class="form-check-input" type="radio" name="extraCuidarUnAnio" value="Sí" required><label class="form-check-label">Sí</label></div><div class="form-check"><input class="form-check-input" type="radio" name="extraCuidarUnAnio" value="No" required><label class="form-check-label">No</label></div></div>
                        <div class="q-block"><div class="q-title">12. ¿Y de aquí a 5 o 10 años?</div><div class="form-check"><input class="form-check-input" type="radio" name="extraCuidarDiezAnios" value="Sí" required><label class="form-check-label">Sí</label></div><div class="form-check"><input class="form-check-input" type="radio" name="extraCuidarDiezAnios" value="No" required><label class="form-check-label">No</label></div></div>
                        <div class="q-block"><div class="q-title">13. ¿Qué haría si la mascota presenta problemas de comportamiento?</div><select class="form-select" name="planMascota" required><option value="" selected disabled>Selecciona</option><option>Buscar ayuda veterinaria y adiestramiento</option><option>Aplicar rutina de corrección con paciencia</option><option>Pedir orientación profesional inmediata</option></select></div>
                    </div>
                    <div class="col-md-6">
                        <div class="q-block"><div class="q-title">14. Si viaja por semanas, ¿quién cuidará la mascota?</div><select class="form-select" name="extraViajeSemanas" required><option value="" selected disabled>Selecciona</option><option>Familiar cercano</option><option>Cuidador de confianza</option><option>No suelo viajar</option></select></div>
                        <div class="q-block"><div class="q-title">15. Si viaja por meses, ¿qué hará?</div><select class="form-select" name="extraViajeMeses" required><option value="" selected disabled>Selecciona</option><option>Llevarla conmigo</option><option>Dejarla con familiar responsable</option><option>Servicio profesional de cuidado</option></select></div>
                        <div class="q-block"><div class="q-title">16. Información adicional (opcional y breve)</div><textarea class="form-control" name="infoAdicional" id="infoAdicional" rows="2" maxlength="500" placeholder="Solo si deseas agregar algo..."></textarea></div>
                    </div>
                </div>
            </section>

            <section class="lp-section" data-step="4">
                <div class="card border-0 shadow-sm">
                    <div class="card-body row g-3 align-items-center">
                        <div class="col-md-7">
                            <h2 class="h3 mb-2">RESULTADOS DE LA SOLICITUD</h2>
                            <div class="mb-2"><label class="small text-muted">SOLICITANTE</label><input class="form-control" th:value="${usuario != null ? usuario.nombre : ''}" readonly></div>
                            <div class="mb-2"><label class="small text-muted">CELULAR</label><input class="form-control" th:value="${usuario != null ? usuario.telefono : ''}" readonly></div>
                            <div class="mb-2"><label class="small text-muted">CORREO ELECTRÓNICO</label><input class="form-control" th:value="${usuario != null ? usuario.correo : ''}" readonly></div>
                            <p class="mb-1">Al enviar, te confirmaremos por correo la recepción de tu solicitud.</p>
                            <p class="mb-0">Después de la evaluación, te notificaremos los siguientes pasos.</p>
                        </div>
                        <div class="col-md-5 text-center">
                            <h3 class="display-6 fw-semibold">¡Felicitaciones!</h3>
                            <div class="display-1 text-success">✓</div>
                            <p class="mb-0">Estás a un paso de completar tu solicitud de adopción.</p>
                        </div>
                    </div>
                </div>
            </section>

            <div class="d-flex gap-2 mt-4">
                <a class="btn btn-outline-secondary" th:href="@{'/mascotas/' + ${mascota.id}}">Cancelar</a>
                <button class="btn btn-outline-secondary" type="button" id="prevBtn">Atrás</button>
                <button class="btn btn-primary" type="button" id="nextBtn">Siguiente</button>
                <button class="btn btn-success ms-auto d-none" type="submit" id="submitBtn">Finalizar</button>
            </div>
        </form>
    </div>
</div>

<script>
(() => {
    const steps = [...document.querySelectorAll('.lp-section')];
    const stepIndicators = [...document.querySelectorAll('.lp-step')];
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const submitBtn = document.getElementById('submitBtn');
    const form = document.getElementById('solicitudForm');
    let current = 0;
    let confirmedSend = false;

    const update = () => {
        steps.forEach((s, i) => s.classList.toggle('active', i === current));
        stepIndicators.forEach((s, i) => s.classList.toggle('active', i === current));
        prevBtn.disabled = current === 0;
        nextBtn.classList.toggle('d-none', current === steps.length - 1);
        submitBtn.classList.toggle('d-none', current !== steps.length - 1);
    };

    const validateCurrentStep = () => {
        const fields = steps[current].querySelectorAll('input, select, textarea');
        for (const field of fields) {
            if (!field.checkValidity()) {
                field.reportValidity();
                return false;
            }
        }
        return true;
    };

    nextBtn.addEventListener('click', () => {
        if (!validateCurrentStep()) return;
        current = Math.min(current + 1, steps.length - 1);
        update();
    });

    prevBtn.addEventListener('click', () => {
        current = Math.max(current - 1, 0);
        update();
    });

    form.addEventListener('submit', async (event) => {
        if (confirmedSend) return;
        event.preventDefault();

        const result = await Swal.fire({
            icon: 'success',
            title: '¡Solicitud lista!',
            text: 'Tu solicitud de adopción se enviará ahora.',
            confirmButtonText: 'Enviar'
        });

        if (result.isConfirmed) {
            confirmedSend = true;
            form.submit();
        }
    });

    update();
})();
</script>

</body>
</html>
