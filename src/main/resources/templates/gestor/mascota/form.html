<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title
	th:text="${mascota.id == null ? 'Nueva Mascota' : 'Editar Mascota'}"></title>

<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
	rel="stylesheet">
<link th:href="@{/css/admin.css}" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body class="bg-light">
	<div th:replace="~{fragments/navbar :: navbar}"></div>

	<div class="container py-4">

		<a href="/gestor/mascotas" class="btn btn-outline-secondary mb-3">←
			Volver</a>

		<h3 class="fw-bold mb-4"
			th:text="${mascota.id == null ? '➕ Registrar Mascota' : '✏️ Editar Mascota'}"></h3>

		<form
				th:action="@{${mascota.id == null} ? '/gestor/mascotas/guardar' : '/gestor/mascotas/actualizar'}"
				method="post" enctype="multipart/form-data" th:object="${mascota}">

			<input type="hidden" th:field="*{id}" />
			<input type="hidden" th:field="*{fotoUrl}" />

			<div class="card shadow-sm border-0">
				<div class="card-body">
					<div class="row g-4">

						<div class="col-lg-6">
							<label class="form-label">Nombre</label>
							<input type="text" class="form-control" th:field="*{nombre}" required>
							<div class="text-danger small" th:errors="*{nombre}"></div>
						</div>

						<div class="col-lg-3 col-md-6">
							<label class="form-label">Edad</label>
							<input type="number" class="form-control" th:field="*{edad}" min="0" required>
							<div class="text-danger small" th:errors="*{edad}"></div>
						</div>

						<div class="col-lg-3 col-md-6">
							<label class="form-label">Sexo</label>
							<select class="form-select" th:field="*{sexo}">
								<option value="M">Macho</option>
								<option value="H">Hembra</option>
							</select>
							<div class="text-danger small" th:errors="*{sexo}"></div>
						</div>

						<div class="col-md-6">
							<label class="form-label">Categoría</label>
							<select class="form-select" th:field="*{categoria.id}" required>
								<option value="">Seleccione...</option>
								<option th:each="c : ${categorias}" th:value="${c.id}"
									th:text="${c.nombre}"></option>
							</select>
							<div class="text-danger small" th:errors="*{categoria}"></div>
						</div>

						<div class="col-md-6">
							<label class="form-label">Raza</label>
							<select class="form-select" th:field="*{raza.id}" required>
								<option value="">Seleccione...</option>
								<option th:each="r : ${razas}" th:value="${r.id}"
									th:text="${r.nombre}"></option>
							</select>
							<div class="text-danger small" th:errors="*{raza}"></div>
						</div>

						<div class="col-lg-6">
							<label class="form-label">Foto</label>
							<input type="file" class="form-control" name="foto" accept="image/*"
								onchange="previewNuevaFoto(event)">
							<div class="text-danger small" th:text="${fileError}"></div>
							<small class="text-muted d-block mt-2">Formatos recomendados: JPG o PNG.</small>
						</div>

						<div class="col-lg-6">
							<label class="form-label">Vista previa</label>
							<div class="border rounded p-3 bg-white text-center h-100 d-flex align-items-center justify-content-center">
								<img id="previewActual"
									th:src="${mascota.fotoUrl != null ? mascota.fotoUrl : '/images/mascotas/mascota-default.jpg'}"
									alt="Vista previa de la mascota"
									style="max-height:220px; width:auto; max-width:100%; object-fit:cover; border-radius:8px;" />
							</div>
							<small class="text-muted d-block mt-2">Si subes una nueva foto, esta vista previa se actualizará.</small>
						</div>

						<div class="col-12">
							<label class="form-label">Descripción</label>
							<textarea class="form-control" rows="4" th:field="*{descripcion}"></textarea>
							<div class="text-danger small" th:errors="*{descripcion}"></div>
						</div>

						<div class="col-12 d-flex justify-content-end gap-2 pt-2">
							<a href="/gestor/mascotas" class="btn btn-outline-secondary">Cancelar</a>
							<button class="btn btn-primary" type="submit">
								<i class="bi bi-save"></i>
								<span th:text="${mascota.id == null ? 'Guardar Mascota' : 'Actualizar Mascota'}"></span>
							</button>
						</div>

					</div>
				</div>
<<<<<<< HEAD

				<div class="col-md-3">
					<label class="form-label">Edad</label> <input type="number"
						class="form-control" th:field="*{edad}" min="0" required>
					<div class="text-danger small" th:errors="*{edad}"></div>
				</div>

				<div class="col-md-3">
					<label class="form-label">Sexo</label> <select class="form-select"
						th:field="*{sexo}">
						<option value="M">Macho</option>
						<option value="H">Hembra</option>
					</select>
					<div class="text-danger small" th:errors="*{sexo}"></div>
				</div>

				<div class="col-md-6">
					<label class="form-label">Categoría</label> <select
						class="form-select" th:field="*{categoria.id}" required>
						<option value="">Seleccione...</option>
						<option th:each="c : ${categorias}" th:value="${c.id}"
							th:text="${c.nombre}"></option>
					</select>
					<div class="text-danger small" th:errors="*{categoria}"></div>
				</div>

				<div class="col-md-6">
					<label class="form-label">Raza</label> <select class="form-select"
						th:field="*{raza.id}" required>
						<option value="">Seleccione...</option>
						<option th:each="r : ${razas}" th:value="${r.id}"
							th:text="${r.nombre}"></option>
					</select>
					<div class="text-danger small" th:errors="*{raza}"></div>
				</div>

				<div class="col-12">
					<label class="form-label">Descripción</label>
					<textarea class="form-control" rows="4" th:field="*{descripcion}"></textarea>
					<div class="text-danger small" th:errors="*{descripcion}"></div>
				</div>

				<div class="col-md-6">
					<label class="form-label">Foto</label> <input type="file"
						class="form-control" name="foto" accept="image/*"
						onchange="previewNuevaFoto(event)">
					<div class="text-danger small" th:text="${fileError}"></div>
				</div>

				<div class="col-md-6" th:if="${mascota.id != null}">
					<label class="form-label">Imagen actual</label>
					<div class="border rounded p-2 bg-white text-center">
						<img id="previewActual"
							 th:src="${mascota.fotoUrl != null ? mascota.fotoUrl : '/images/mascotas/mascota-default.jpg'}"
							 alt="Imagen actual de la mascota"
							 style="max-height:220px; width:auto; max-width:100%; object-fit:cover; border-radius:8px;"/>
					</div>
					<small class="text-muted">Si subes una nueva foto, esta vista previa se actualizará.</small>
				</div>

=======
>>>>>>> refs/heads/codex/update-card-and-label-styles
			</div>

<<<<<<< HEAD
			<button class="btn btn-primary mt-4 w-100" type="submit">
				<i class="bi bi-save"></i> <span
					th:text="${mascota.id == null ? 'Guardar Mascota' : 'Actualizar Mascota'}"></span>
			</button>
=======
>>>>>>> refs/heads/codex/update-card-and-label-styles
			<div th:if="${#fields.hasErrors('*') or fileError != null}">
				<script>
				Swal.fire({icon:'warning',title:'Formulario inválido',text:'Revisa los campos marcados e intenta nuevamente.'});
				</script>
			</div>
		</form>

	</div>

	<script>
<<<<<<< HEAD
	function previewNuevaFoto(event) {
	    const [file] = event.target.files;
	    const preview = document.getElementById('previewActual');
	    if (file && preview) {
	        preview.src = URL.createObjectURL(file);
	    }
	}
=======
		function previewNuevaFoto(event) {
			const [file] = event.target.files;
			const preview = document.getElementById('previewActual');
			if (file && preview) {
				preview.src = URL.createObjectURL(file);
			}
		}
>>>>>>> refs/heads/codex/update-card-and-label-styles
	</script>

</body>
</html>
