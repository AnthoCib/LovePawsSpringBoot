<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title th:text="${mascota.nombre} + ' - LovePaws'">Detalle mascota</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link th:href="@{/css/adopcion-flujo.css}" rel="stylesheet"/>
</head>
<body class="page-shell">
<div th:replace="~{fragments/navbar :: navbar}"></div>
<div class="container py-4">
    <div class="section-card p-4">
        <a th:href="@{/mascotas}" class="btn btn-outline-secondary btn-sm mb-3">← Volver al catálogo</a>

        <div class="adopcion-hero mb-4">
            <h1 class="h4 mb-0" th:text="'Solicitud de adopción de ' + ${mascota.nombre}">Solicitud de adopción</h1>
        </div>

        <div class="stepper mb-4">
            <article class="step active">
                <div class="step-number">1</div>
                <h2 class="h6">Datos del contacto</h2>
                <p class="mb-0 text-muted">Confirma tus datos personales.</p>
            </article>
            <article class="step">
                <div class="step-number">2</div>
                <h2 class="h6">Nuevo hogar</h2>
                <p class="mb-0 text-muted">Cuéntanos sobre tu hogar.</p>
            </article>
            <article class="step">
                <div class="step-number">3</div>
                <h2 class="h6">Intereses</h2>
                <p class="mb-0 text-muted">Describe tu motivación.</p>
            </article>
            <article class="step">
                <div class="step-number">4</div>
                <h2 class="h6">Enviar solicitud</h2>
                <p class="mb-0 text-muted">Revisa y envía.</p>
            </article>
        </div>

        <div class="row g-4">
            <div class="col-md-5">
                <img th:src="${mascota.fotoUrl != null ? mascota.fotoUrl : '/images/mascotas/mascota-default.jpg'}" class="img-fluid rounded" alt="foto mascota">
            </div>
            <div class="col-md-7">
                <h1 class="h3" th:text="${mascota.nombre}">Nombre</h1>
                <p><strong>Raza:</strong> <span th:text="${mascota.raza != null ? mascota.raza.nombre : '-'}"></span></p>
                <p><strong>Categoría:</strong> <span th:text="${mascota.categoria != null ? mascota.categoria.nombre : '-'}"></span></p>
                <p><strong>Edad:</strong> <span th:text="${mascota.edad}"></span> años</p>
                <p><strong>Sexo:</strong> <span th:text="${mascota.sexo}"></span></p>
                <p><strong>Descripción:</strong></p>
                <p th:text="${mascota.descripcion}">Descripción</p>

                <div sec:authorize="hasRole('ADOPTANTE')" class="card mt-4">
                    <div class="card-body">
                        <h5 class="card-title">Solicitar adopción</h5>
                        <p class="text-muted small mb-4">Queremos asegurarnos de que cada mascota llegue a un hogar ideal.
                            Completa estos datos para conocer mejor tu situación y plan de cuidado.</p>
                        <form th:action="@{/adopcion/solicitar}" method="post" class="row g-3">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <input type="hidden" name="mascota.id" th:value="${mascota.id}"/>
                            <div class="col-12">
                                <div class="form-section">
                                    <h6 class="section-title">Datos del contacto</h6>
                                    <p class="text-muted small mb-3">Estos datos provienen de tu perfil.</p>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Nombre completo</label>
                                            <input type="text" class="form-control" readonly
                                                   th:value="${#authentication != null ? #authentication.principal.usuario.nombre : ''}">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Correo electrónico</label>
                                            <input type="email" class="form-control" readonly
                                                   th:value="${#authentication != null ? #authentication.principal.usuario.correo : ''}">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Teléfono de contacto</label>
                                            <input type="text" class="form-control" readonly
                                                   th:value="${#authentication != null ? #authentication.principal.usuario.telefono : ''}">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Dirección</label>
                                            <input type="text" class="form-control" readonly
                                                   th:value="${#authentication != null ? #authentication.principal.usuario.direccion : ''}">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-section">
                                    <h6 class="section-title">Datos del nuevo hogar</h6>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label">1. ¿Vives en casa o departamento?</label>
                                            <div class="option-grid">
                                                <label class="option-card">
                                                    <input type="radio" name="tipoVivienda" value="Casa con patio" required>
                                                    <span>Casa con patio</span>
                                                </label>
                                                <label class="option-card">
                                                    <input type="radio" name="tipoVivienda" value="Casa sin patio" required>
                                                    <span>Casa sin patio</span>
                                                </label>
                                                <label class="option-card">
                                                    <input type="radio" name="tipoVivienda" value="Departamento" required>
                                                    <span>Departamento</span>
                                                </label>
                                                <label class="option-card">
                                                    <input type="radio" name="tipoVivienda" value="Otro" required>
                                                    <span>Otro</span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">2. ¿Hay niños u otras mascotas?</label>
                                            <div class="option-grid">
                                                <label class="option-card">
                                                    <input type="radio" name="ninosOtraMascotas" value="No" required>
                                                    <span>No</span>
                                                </label>
                                                <label class="option-card">
                                                    <input type="radio" name="ninosOtraMascotas" value="Niños en casa" required>
                                                    <span>Sí, hay niños</span>
                                                </label>
                                                <label class="option-card">
                                                    <input type="radio" name="ninosOtraMascotas" value="Otras mascotas" required>
                                                    <span>Sí, hay otras mascotas</span>
                                                </label>
                                                <label class="option-card">
                                                    <input type="radio" name="ninosOtraMascotas" value="Niños y mascotas" required>
                                                    <span>Sí, hay niños y mascotas</span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">3. ¿Cuántas horas al día compartirás con la mascota?</label>
                                            <div class="option-grid">
                                                <label class="option-card">
                                                    <input type="radio" name="tiempoDedicado" value="1-2 horas" required>
                                                    <span>1-2 horas</span>
                                                </label>
                                                <label class="option-card">
                                                    <input type="radio" name="tiempoDedicado" value="3-4 horas" required>
                                                    <span>3-4 horas</span>
                                                </label>
                                                <label class="option-card">
                                                    <input type="radio" name="tiempoDedicado" value="5+ horas" required>
                                                    <span>Más de 5 horas</span>
                                                </label>
                                                <label class="option-card">
                                                    <input type="radio" name="tiempoDedicado" value="Disponible la mayor parte del día" required>
                                                    <span>Disponible la mayor parte del día</span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">4. ¿Puedes cubrir los costos básicos?</label>
                                            <div class="option-grid">
                                                <label class="option-card">
                                                    <input type="radio" name="cubrirCostos" value="Sí" required>
                                                    <span>Sí, estoy preparado(a)</span>
                                                </label>
                                                <label class="option-card">
                                                    <input type="radio" name="cubrirCostos" value="Necesito orientación" required>
                                                    <span>Necesito orientación</span>
                                                </label>
                                            </div>
                                            <div class="form-text">Incluye alimentación, vacunas, controles y emergencias.</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-section">
                                    <h6 class="section-title">Intereses del adoptante</h6>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label">5. Experiencia con mascotas</label>
                                            <div class="option-grid">
                                                <label class="option-card">
                                                    <input type="radio" name="experiencia" value="Primera vez" required>
                                                    <span>Es mi primera mascota</span>
                                                </label>
                                                <label class="option-card">
                                                    <input type="radio" name="experiencia" value="Experiencia previa" required>
                                                    <span>Ya he cuidado mascotas antes</span>
                                                </label>
                                                <label class="option-card">
                                                    <input type="radio" name="experiencia" value="Actualmente tengo mascotas" required>
                                                    <span>Actualmente tengo mascotas</span>
                                                </label>
                                                <label class="option-card">
                                                    <input type="radio" name="experiencia" value="Experiencia avanzada" required>
                                                    <span>Tengo amplia experiencia</span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label">6. ¿Por qué quieres adoptarlo?</label>
                                            <textarea name="pqAdoptar" class="form-control" rows="3" minlength="20" maxlength="600" required
                                                      placeholder="Cuéntanos qué te motivó y cómo encaja esta mascota en tu familia."></textarea>
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label">7. Plan de cuidado</label>
                                            <textarea name="planMascota" class="form-control" rows="3" minlength="20" maxlength="600" required
                                                      placeholder="Describe cómo será su rutina, paseos, alimentación y atención veterinaria."></textarea>
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label">8. Información adicional (opcional)</label>
                                            <textarea name="infoAdicional" class="form-control" rows="3" maxlength="600"
                                                      placeholder="Si deseas añadir algo más, este es el lugar."></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 d-grid d-md-flex justify-content-md-end">
                                <button class="btn btn-success" type="submit">Enviar solicitud</button>
                            </div>
                        </form>
                    </div>
                </div>

                <div sec:authorize="isAnonymous()" class="alert alert-info mt-4">
                    Para solicitar adopción, primero inicia sesión como adoptante.
                    <a th:href="@{/usuarios/login}" class="alert-link">Iniciar sesión</a>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:if="${param.error}">
    <script>
        Swal.fire({icon: 'error', title: 'Solicitud inválida', text: 'No se pudo procesar tu solicitud. Verifica los datos e inténtalo nuevamente.'});
    </script>
</div>
<div th:if="${param.error == 'motivo'}"><script>Swal.fire({icon:'warning',title:'Motivo obligatorio',text:'Debes indicar por qué deseas adoptar.'});</script></div>
<div th:if="${param.error == 'form'}"><script>Swal.fire({icon:'warning',title:'Información incompleta',text:'Completa todos los campos obligatorios.'});</script></div>
</body>
</html>
