<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title th:text="${mascota.nombre} + ' - LovePaws'">Detalle mascota</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link th:href="@{/css/adopcion-flujo.css}" rel="stylesheet"/>
</head>
<body class="page-shell">
<div th:replace="~{fragments/navbar :: navbar}"></div>
<div class="container py-4">
    <div class="section-card p-4">
        <a th:href="@{/mascotas}" class="btn btn-outline-secondary btn-sm mb-3">← Volver al catálogo</a>

        <div class="stepper mb-4">
            <article class="step active">
                <div class="step-number">1</div>
                <h2 class="h6">Elegir mascota</h2>
                <p class="mb-0 text-muted">Revisa información y confirma afinidad.</p>
            </article>
            <article class="step">
                <div class="step-number">2</div>
                <h2 class="h6">Enviar solicitud</h2>
                <p class="mb-0 text-muted">Cuéntanos por qué quieres adoptar.</p>
            </article>
            <article class="step">
                <div class="step-number">3</div>
                <h2 class="h6">Esperar evaluación</h2>
                <p class="mb-0 text-muted">El gestor validará tu solicitud.</p>
            </article>
        </div>

        <div class="row g-4">
            <div class="col-md-5">
                <img th:src="${mascota.fotoUrl != null ? mascota.fotoUrl : '/images/mascotas/mascota-default.jpg'}" class="img-fluid rounded" alt="foto mascota">
            </div>
            <div class="col-md-7">
                <h1 class="h3" th:text="${mascota.nombre}">Nombre</h1>
                <div class="pet-attribute">
                    <span class="meta-label">Raza</span>
                    <span class="meta-value" th:text="${mascota.raza != null ? mascota.raza.nombre : '-'}"></span>
                </div>
                <div class="pet-attribute">
                    <span class="meta-label">Categoría</span>
                    <span class="meta-value" th:text="${mascota.categoria != null ? mascota.categoria.nombre : '-'}"></span>
                </div>
                <div class="pet-attribute">
                    <span class="meta-label">Edad</span>
                    <span class="meta-value"><span th:text="${mascota.edad}"></span> años</span>
                </div>
                <div class="pet-attribute">
                    <span class="meta-label">Sexo</span>
                    <span class="meta-value" th:text="${mascota.sexo}"></span>
                </div>
                <p class="mt-3"><strong>Descripción:</strong></p>
                <p th:text="${mascota.descripcion}">Descripción</p>

                <div sec:authorize="hasRole('ADOPTANTE')" class="card adoption-card mt-4">
                    <div class="card-body">
                        <h5 class="card-title">Solicitar adopción</h5>
                        <p class="text-muted small mb-4">Queremos asegurarnos de que cada mascota llegue a un hogar ideal.
                            Completa estos datos para conocer mejor tu situación y plan de cuidado.</p>
                        <form th:action="@{/adopcion/solicitar}" method="post" class="row g-3">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <input type="hidden" name="mascota.id" th:value="${mascota.id}"/>
                            <div class="col-12">
                                <label class="form-label lp-label">¿Por qué quieres adoptarlo?</label>
                                <textarea name="pqAdoptar" class="form-control" rows="3" minlength="20" maxlength="600" required
                                          placeholder="Cuéntanos qué te motivó y cómo encaja esta mascota en tu familia."></textarea>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label lp-label">Tipo de vivienda</label>
                                <select name="tipoVivienda" class="form-select" required>
                                    <option value="" selected disabled>Selecciona una opción</option>
                                    <option value="Casa con patio">Casa con patio</option>
                                    <option value="Casa sin patio">Casa sin patio</option>
                                    <option value="Departamento">Departamento</option>
                                    <option value="Otro">Otro</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label lp-label">Experiencia con mascotas</label>
                                <select name="experiencia" class="form-select" required>
                                    <option value="" selected disabled>Selecciona una opción</option>
                                    <option value="Primera vez">Es mi primera mascota</option>
                                    <option value="Experiencia previa">Ya he cuidado mascotas antes</option>
                                    <option value="Actualmente tengo mascotas">Actualmente tengo mascotas</option>
                                    <option value="Experiencia avanzada">Tengo amplia experiencia</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label lp-label">¿Hay niños u otras mascotas?</label>
                                <select name="ninosOtraMascotas" class="form-select" required>
                                    <option value="" selected disabled>Selecciona una opción</option>
                                    <option value="No">No</option>
                                    <option value="Niños en casa">Sí, hay niños</option>
                                    <option value="Otras mascotas">Sí, hay otras mascotas</option>
                                    <option value="Niños y mascotas">Sí, hay niños y mascotas</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label lp-label">Tiempo disponible al día</label>
                                <select name="tiempoDedicado" class="form-select" required>
                                    <option value="" selected disabled>Selecciona una opción</option>
                                    <option value="1-2 horas">1-2 horas</option>
                                    <option value="3-4 horas">3-4 horas</option>
                                    <option value="5+ horas">Más de 5 horas</option>
                                    <option value="Disponible la mayor parte del día">Disponible la mayor parte del día</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label lp-label">Plan de cuidado</label>
                                <textarea name="planMascota" class="form-control" rows="3" minlength="20" maxlength="600" required
                                          placeholder="Describe cómo será su rutina, paseos, alimentación y atención veterinaria."></textarea>
                            </div>
                            <div class="col-12">
                                <label class="form-label lp-label">¿Puedes cubrir los costos básicos?</label>
                                <select name="cubrirCostos" class="form-select" required>
                                    <option value="" selected disabled>Selecciona una opción</option>
                                    <option value="Sí">Sí, estoy preparado(a)</option>
                                    <option value="Necesito orientación">Necesito orientación</option>
                                </select>
                                <div class="form-text">Incluye alimentación, vacunas, controles y emergencias.</div>
                            </div>
                            <div class="col-12">
                                <label class="form-label lp-label">Información adicional (opcional)</label>
                                <textarea name="infoAdicional" class="form-control" rows="3" maxlength="600"
                                          placeholder="Si deseas añadir algo más, este es el lugar."></textarea>
                            </div>
                            <div class="col-12 d-grid d-md-flex justify-content-md-end">
                                <button class="btn btn-success" type="submit">Enviar solicitud</button>
                            </div>
                        </form>
                    </div>
                </div>

                <div sec:authorize="isAnonymous()" class="alert alert-info mt-4">
                    Para solicitar adopción, primero inicia sesión como adoptante.
                    <a th:href="@{/usuarios/login}" class="alert-link">Iniciar sesión</a>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:if="${param.error}">
    <script>
        Swal.fire({icon: 'error', title: 'Solicitud inválida', text: 'No se pudo procesar tu solicitud. Verifica los datos e inténtalo nuevamente.'});
    </script>
</div>
<div th:if="${param.error == 'motivo'}"><script>Swal.fire({icon:'warning',title:'Motivo obligatorio',text:'Debes indicar por qué deseas adoptar.'});</script></div>
<div th:if="${param.error == 'form'}"><script>Swal.fire({icon:'warning',title:'Información incompleta',text:'Completa todos los campos obligatorios.'});</script></div>
</body>
</html>
